{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Nazmul/OneDrive/Documents/trust-market/frontend/pages/admin/messages.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { io } from \"socket.io-client\";\r\nimport {\r\n  Phone,\r\n  MessageCircle,\r\n  FileText,\r\n  Paperclip,\r\n  Send,\r\n  Trash2,\r\n  Video,\r\n} from \"lucide-react\";\r\n\r\n// Helper\r\nconst readableSize = (size) => {\r\n  if (!size) return \"0 B\";\r\n  const i = Math.floor(Math.log(size) / Math.log(1024));\r\n  return (size / Math.pow(1024, i)).toFixed(2) * 1 + \" \" + [\"B\", \"KB\", \"MB\", \"GB\"][i];\r\n};\r\n\r\nexport default function AdminMessages() {\r\n  const [conversations, setConversations] = useState([]);\r\n  const [activeConvId, setActiveConvId] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [text, setText] = useState(\"\");\r\n  const [attachments, setAttachments] = useState([]);\r\n  const messagesEndRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n  const [socket, setSocket] = useState(null);\r\n\r\n  // Init socket\r\n  useEffect(() => {\r\n    const s = io(\"http://localhost:5000\"); // backend socket url\r\n    setSocket(s);\r\n\r\n    // Receive message from user\r\n    s.on(\"receive_message\", (msg) => {\r\n      setMessages((prev) => {\r\n        const updated = [...prev, msg];\r\n        localStorage.setItem(\"admin_messages\", JSON.stringify(updated));\r\n        return updated;\r\n      });\r\n    });\r\n\r\n    return () => s.disconnect();\r\n  }, []);\r\n\r\n  // Load saved messages\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"admin_messages\");\r\n    if (saved) setMessages(JSON.parse(saved));\r\n  }, []);\r\n\r\n  // Mock conversations\r\n  useEffect(() => {\r\n    const mock = [\r\n      { id: \"buyer_1\", name: \"Buyer 1\", last: \"Hi, product available?\", unread: 2 },\r\n      { id: \"buyer_2\", name: \"Buyer 2\", last: \"Price please?\", unread: 0 },\r\n      { id: \"buyer_3\", name: \"Buyer 3\", last: \"Thanks!\", unread: 0 },\r\n    ];\r\n    setConversations(mock);\r\n    setActiveConvId(mock[0].id);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  // File Attach\r\n  const handleFiles = (files) => {\r\n    const newAtts = [];\r\n    Array.from(files).forEach((file) => {\r\n      const type = file.type.startsWith(\"image/\")\r\n        ? \"image\"\r\n        : file.type.startsWith(\"video/\")\r\n        ? \"video\"\r\n        : \"file\";\r\n      const preview = type === \"file\" ? null : URL.createObjectURL(file);\r\n      newAtts.push({ id: Date.now() + Math.random(), file, preview, type });\r\n    });\r\n    setAttachments((prev) => [...prev, ...newAtts]);\r\n  };\r\n\r\n  const removeAttachment = (id) => setAttachments((prev) => prev.filter((a) => a.id !== id));\r\n\r\n  // Send message\r\n  const sendMessage = () => {\r\n    if (!text && attachments.length === 0) return;\r\n    const msg = {\r\n      id: \"m\" + Date.now(),\r\n      from: \"admin\",\r\n      text,\r\n      time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n      attachments: attachments.map(a => ({ type: a.type, name: a.file.name, preview: a.preview })),\r\n      convId: activeConvId,\r\n    };\r\n    setMessages((prev) => {\r\n      const updated = [...prev, msg];\r\n      localStorage.setItem(\"admin_messages\", JSON.stringify(updated));\r\n      return updated;\r\n    });\r\n    socket?.emit(\"send_message\", msg); // Send to user\r\n    setText(\"\"); setAttachments([]);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h1 className=\"text-xl font-bold flex items-center gap-2\">\r\n          <MessageCircle className=\"w-6 h-6 text-blue-600\" /> Admin Messages\r\n        </h1>\r\n        <Link href=\"/admin/pages\" className=\"px-3 py-2 bg-gray-700 text-white rounded-md shadow\">\r\n          Back to Home\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-xl shadow grid grid-cols-12 overflow-hidden\">\r\n        {/* Conversations */}\r\n        <aside className=\"col-span-12 md:col-span-3 border-r p-3 h-[70vh] overflow-auto\">\r\n          <h3 className=\"font-semibold mb-3 text-sm\">Chats</h3>\r\n          {conversations.map(c => (\r\n            <div\r\n              key={c.id}\r\n              onClick={() => setActiveConvId(c.id)}\r\n              className={`p-2 rounded-lg cursor-pointer mb-2 ${activeConvId===c.id?'bg-blue-50 border border-blue-200':'hover:bg-gray-50'}`}\r\n            >\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center font-semibold\">\r\n                  {c.name[0]}\r\n                </div>\r\n                <div>\r\n                  <div className=\"font-medium text-sm\">{c.name}</div>\r\n                  <div className=\"text-xs text-gray-500\">{c.last}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </aside>\r\n\r\n        {/* Chat Window */}\r\n        <section className=\"col-span-12 md:col-span-6 p-3 flex flex-col h-[70vh]\">\r\n          <div className=\"flex items-center justify-between border-b pb-2\">\r\n            <div>\r\n              <div className=\"font-semibold\">{conversations.find(c=>c.id===activeConvId)?.name}</div>\r\n              <div className=\"text-xs text-gray-500\">Online</div>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button className=\"p-2 hover:bg-gray-100 rounded\"><Phone className=\"w-4 h-4\"/></button>\r\n              <button className=\"p-2 hover:bg-gray-100 rounded\"><Video className=\"w-4 h-4\"/></button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex-1 overflow-auto p-3\">\r\n            {messages.filter(m=>m.convId===activeConvId).map(msg=>(\r\n              <div key={msg.id} className={`mb-3 flex ${msg.from==='admin'?'justify-end':'justify-start'}`}>\r\n                <div className={`p-3 rounded-xl max-w-[75%] ${msg.from==='admin'?'bg-blue-600 text-white':'bg-gray-100'}`}>\r\n                  <div>{msg.text}</div>\r\n                  {msg.attachments?.map((a,i)=>(\r\n                    <div key={i} className=\"mt-2\">\r\n                      {a.type==='image' && <img src={a.preview} className=\"rounded-md max-w-xs\"/>}\r\n                      {a.type==='video' && <video src={a.preview} controls className=\"rounded-md max-w-xs\"/>}\r\n                      {a.type==='file' && <div className=\"flex items-center gap-2 bg-white p-2 rounded\"><FileText className=\"w-4 h-4\"/>{a.name}</div>}\r\n                    </div>\r\n                  ))}\r\n                  <div className=\"text-[10px] opacity-70 mt-1 text-right\">{msg.time}</div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n            <div ref={messagesEndRef}></div>\r\n          </div>\r\n\r\n          {/* Composer */}\r\n          <div className=\"border-t pt-2 mt-2 flex items-center gap-2\">\r\n            <button onClick={()=>fileInputRef.current.click()} className=\"p-2 rounded hover:bg-gray-100\"><Paperclip className=\"w-5 h-5\"/></button>\r\n            <input type=\"file\" className=\"hidden\" ref={fileInputRef} multiple onChange={e=>handleFiles(e.target.files)}/>\r\n            <textarea value={text} onChange={e=>setText(e.target.value)} rows={2} className=\"flex-1 p-2 rounded-md border resize-none\" placeholder=\"Write your message...\"/>\r\n            <button onClick={sendMessage} className=\"px-3 py-2 bg-blue-600 text-white rounded-md flex items-center gap-2\"><Send className=\"w-4 h-4\"/> Send</button>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Buyer Info */}\r\n        <aside className=\"hidden md:block col-span-3 p-3 border-l text-sm\">\r\n          <h3 className=\"font-semibold mb-2\">Buyer Info</h3>\r\n          <p className=\"text-gray-600 text-xs\">\r\n            এখানে buyer/user এর basic info, order details, product interest ইত্যাদি show হবে।\r\n          </p>\r\n        </aside>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}