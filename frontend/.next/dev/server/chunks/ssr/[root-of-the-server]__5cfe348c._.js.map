{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/trust-market/frontend/utils/api.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst api = axios.create({\r\n  baseURL: \"http://localhost:5000/api\",\r\n});\r\n\r\n// Automatically send token in every request\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (token) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n});\r\n\r\nexport default api;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,MAAM,qHAAK,CAAC,MAAM,CAAC;IACvB,SAAS;AACX;AAEA,4CAA4C;AAC5C,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAC5B,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IAClD;IACA,OAAO;AACT;uCAEe","debugId":null}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///D:/trust-market/frontend/pages/admin/messages/index.js"],"sourcesContent":["// frontend/pages/admin/message.js\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport api from \"../../../utils/api\";\r\n\r\nexport default function AdminMessages() {\r\n  const [users, setUsers] = useState([]);\r\n  const router = useRouter();\r\n\r\n  const loadUsers = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) return;\r\n\r\n      const res = await api.get(\"/admin/message-users\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      const sorted = res.data.sort(\r\n        (a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime)\r\n      );\r\n\r\n      setUsers(sorted);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadUsers();\r\n    const interval = setInterval(() => loadUsers(), 3000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === \"visible\") {\r\n        loadUsers();\r\n      }\r\n    };\r\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n    return () =>\r\n      document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n  }, []);\r\n\r\n  const formatTime = (time) => {\r\n    if (!time) return \"No messages yet\";\r\n    const date = new Date(time);\r\n\r\n    let hours = date.getHours();\r\n    const minutes = date.getMinutes().toString().padStart(2, \"0\");\r\n    const ampm = hours >= 12 ? \"PM\" : \"AM\";\r\n\r\n    hours = hours % 12;\r\n    hours = hours ? hours : 12; // 0 => 12\r\n    const day = date.getDate().toString().padStart(2, \"0\");\r\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n    const year = date.getFullYear();\r\n\r\n    return `${month}/${day}/${year} ${hours}:${minutes} ${ampm}`;\r\n  };\r\n\r\n  const openChat = async (userId) => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) return;\r\n\r\n      await api.post(\r\n        `/admin/messages/mark-read/${userId}`,\r\n        {},\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      setUsers((prev) =>\r\n        prev.map((u) => (u._id === userId ? { ...u, unreadCount: 0 } : u))\r\n      );\r\n\r\n      router.push(`/admin/messages/${userId}`);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6 relative\">\r\n      {/* Back button */}\r\n      <button\r\n        onClick={() => router.back()}\r\n        className=\"absolute top-4 md:top-6 right-4 md:right-6 bg-blue-600 text-white px-3 md:px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition text-sm md:text-base\"\r\n      >\r\n        ‚Üê Back\r\n      </button>\r\n\r\n      <h2 className=\"text-2xl md:text-3xl font-semibold mb-6 text-gray-700\">\r\n        üí¨ User Messages\r\n      </h2>\r\n\r\n      {users.length === 0 ? (\r\n        <p className=\"text-gray-500 text-sm md:text-base\">No users found</p>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4\">\r\n          {users.map((u) => (\r\n            <div\r\n              key={u._id}\r\n              onClick={() => openChat(u._id)}\r\n              className=\"relative bg-white p-4 md:p-5 rounded-2xl shadow-md border border-gray-200 cursor-pointer transition hover:shadow-xl hover:-translate-y-1\"\r\n            >\r\n              {u.unreadCount > 0 && (\r\n                <div className=\"absolute top-2 md:top-3 right-2 md:right-3 bg-red-500 text-white w-5 h-5 md:w-6 md:h-6 flex items-center justify-center rounded-full text-xs md:text-sm font-bold\">\r\n                  {u.unreadCount}\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-10 h-10 md:w-12 md:h-12 bg-blue-100 flex justify-center items-center rounded-full text-lg md:text-xl\">\r\n                  üë§\r\n                </div>\r\n                <div>\r\n                  <p className=\"font-semibold text-gray-800 text-sm md:text-base\">\r\n                    {u.name || \"Unknown User\"}\r\n                  </p>\r\n                  <p className=\"text-gray-500 text-xs md:text-sm\">{u.email}</p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"mt-2 md:mt-3 text-gray-600 text-xs md:text-sm\">\r\n                ‚è± Last Message:{\" \"}\r\n                <span className=\"font-medium\">{formatTime(u.lastMessageTime)}</span>\r\n              </div>\r\n\r\n              <div className=\"mt-1 md:mt-2 text-blue-600 text-xs md:text-sm font-medium\">\r\n                Click to view chat ‚Üí\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;;AAClC;AACA;AACA;;;;;;;;;AAEe,SAAS;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAC,EAAE;IACrC,MAAM,SAAS,IAAA,gJAAS;IAExB,MAAM,YAAY;QAChB,IAAI;YACF,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,CAAC,OAAO;YAEZ,MAAM,MAAM,MAAM,4HAAG,CAAC,GAAG,CAAC,wBAAwB;gBAChD,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,OAAO;gBAAC;YAC9C;YAEA,MAAM,SAAS,IAAI,IAAI,CAAC,IAAI,CAC1B,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,eAAe,IAAI,IAAI,KAAK,EAAE,eAAe;YAGpE,SAAS;QACX,EAAE,OAAO,KAAK;YACZ,QAAQ,GAAG,CAAC;QACd;IACF;IAEA,IAAA,gHAAS,EAAC;QACR;QACA,MAAM,WAAW,YAAY,IAAM,aAAa;QAChD,OAAO,IAAM,cAAc;IAC7B,GAAG,EAAE;IAEL,IAAA,gHAAS,EAAC;QACR,MAAM,yBAAyB;YAC7B,IAAI,SAAS,eAAe,KAAK,WAAW;gBAC1C;YACF;QACF;QACA,SAAS,gBAAgB,CAAC,oBAAoB;QAC9C,OAAO,IACL,SAAS,mBAAmB,CAAC,oBAAoB;IACrD,GAAG,EAAE;IAEL,MAAM,aAAa,CAAC;QAClB,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,OAAO,IAAI,KAAK;QAEtB,IAAI,QAAQ,KAAK,QAAQ;QACzB,MAAM,UAAU,KAAK,UAAU,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;QACzD,MAAM,OAAO,SAAS,KAAK,OAAO;QAElC,QAAQ,QAAQ;QAChB,QAAQ,QAAQ,QAAQ,IAAI,UAAU;QACtC,MAAM,MAAM,KAAK,OAAO,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;QAClD,MAAM,QAAQ,CAAC,KAAK,QAAQ,KAAK,CAAC,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG;QAC3D,MAAM,OAAO,KAAK,WAAW;QAE7B,OAAO,GAAG,MAAM,CAAC,EAAE,IAAI,CAAC,EAAE,KAAK,CAAC,EAAE,MAAM,CAAC,EAAE,QAAQ,CAAC,EAAE,MAAM;IAC9D;IAEA,MAAM,WAAW,OAAO;QACtB,IAAI;YACF,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,CAAC,OAAO;YAEZ,MAAM,4HAAG,CAAC,IAAI,CACZ,CAAC,0BAA0B,EAAE,QAAQ,EACrC,CAAC,GACD;gBAAE,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,OAAO;gBAAC;YAAE;YAGlD,SAAS,CAAC,OACR,KAAK,GAAG,CAAC,CAAC,IAAO,EAAE,GAAG,KAAK,SAAS;wBAAE,GAAG,CAAC;wBAAE,aAAa;oBAAE,IAAI;YAGjE,OAAO,IAAI,CAAC,CAAC,gBAAgB,EAAE,QAAQ;QACzC,EAAE,OAAO,KAAK;YACZ,QAAQ,GAAG,CAAC;QACd;IACF;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BAEb,qKAAC;gBACC,SAAS,IAAM,OAAO,IAAI;gBAC1B,WAAU;0BACX;;;;;;0BAID,qKAAC;gBAAG,WAAU;0BAAwD;;;;;;YAIrE,MAAM,MAAM,KAAK,kBAChB,qKAAC;gBAAE,WAAU;0BAAqC;;;;;qCAElD,qKAAC;gBAAI,WAAU;0BACZ,MAAM,GAAG,CAAC,CAAC,kBACV,qKAAC;wBAEC,SAAS,IAAM,SAAS,EAAE,GAAG;wBAC7B,WAAU;;4BAET,EAAE,WAAW,GAAG,mBACf,qKAAC;gCAAI,WAAU;0CACZ,EAAE,WAAW;;;;;;0CAIlB,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAI,WAAU;kDAAyG;;;;;;kDAGxH,qKAAC;;0DACC,qKAAC;gDAAE,WAAU;0DACV,EAAE,IAAI,IAAI;;;;;;0DAEb,qKAAC;gDAAE,WAAU;0DAAoC,EAAE,KAAK;;;;;;;;;;;;;;;;;;0CAI5D,qKAAC;gCAAI,WAAU;;oCAAgD;oCAC7C;kDAChB,qKAAC;wCAAK,WAAU;kDAAe,WAAW,EAAE,eAAe;;;;;;;;;;;;0CAG7D,qKAAC;gCAAI,WAAU;0CAA4D;;;;;;;uBA3BtE,EAAE,GAAG;;;;;;;;;;;;;;;;AAoCxB","debugId":null}}]
}