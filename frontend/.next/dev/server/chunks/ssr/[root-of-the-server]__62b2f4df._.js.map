{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Nazmul/OneDrive/Documents/trust-market/frontend/pages/admin/messages/index.js"],"sourcesContent":["// pages/admin/page/message.js - Frontend (Client Side)\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport io from 'socket.io-client';\r\n\r\nconst socket = io('http://localhost:3001'); \r\n\r\nfunction AdminPanel() {\r\n  const [activeChats, setActiveChats] = useState([]);\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [message, setMessage] = useState('');\r\n\r\n  // ================================\r\n  // 1ï¸âƒ£ Load All Chats (Replace Fake)\r\n  // ================================\r\n  useEffect(() => {\r\n    const fetchChats = async () => {\r\n      const res = await fetch(\"http://localhost:3000/chats/all\");\r\n      const data = await res.json();\r\n      setActiveChats(data);\r\n    };\r\n\r\n    fetchChats();\r\n\r\n    // Receive message\r\n    socket.on('receive_message', (msg) => {\r\n      if (selectedChat && msg.chatId === selectedChat.chatId) {\r\n        setMessages((prev) => [...prev, msg]);\r\n      }\r\n\r\n      setActiveChats(prev => \r\n        prev.map(c => \r\n          c.chatId === msg.chatId\r\n            ? { ...c, lastMessage: msg.text, adminHasUnread: true }\r\n            : c\r\n        )\r\n      );\r\n    });\r\n\r\n    return () => socket.off('receive_message');\r\n\r\n  }, [selectedChat]);\r\n\r\n  // ============================================\r\n  // 2ï¸âƒ£ Select Chat â†’ Load messages from backend\r\n  // ============================================\r\n  const selectChat = async (chat) => {\r\n    setSelectedChat(chat);\r\n\r\n    const res = await fetch(`http://localhost:3001/messages/${chat.chatId}`);\r\n    const data = await res.json();\r\n    setMessages(data.data);\r\n\r\n    setActiveChats(prev =>\r\n      prev.map(c =>\r\n        c.chatId === chat.chatId ? { ...c, adminHasUnread: false } : c\r\n      )\r\n    );\r\n  };\r\n\r\n  // ============================\r\n  // 3ï¸âƒ£ Send Message (IMPORTANT)\r\n  // ============================\r\n  const sendMessage = (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!selectedChat) {\r\n      alert(\"Please select a chat\");\r\n      return;\r\n    }\r\n\r\n    if (!message.trim()) return;\r\n\r\n    const msgData = {\r\n      chatId: selectedChat.chatId,\r\n      userId: selectedChat.userId,\r\n      userName: selectedChat.userName,\r\n      text: message,\r\n      sender: \"admin\",\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n\r\n    socket.emit(\"send_message\", msgData);\r\n    setMessages(prev => [...prev, msgData]);\r\n    setMessage(\"\");\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: 'flex' }}>\r\n      \r\n      {/* LEFT SIDEBAR */}\r\n      <div style={{ width: '30%', borderRight: '1px solid #ccc', padding: '10px' }}>\r\n        <h2>All User Chats ðŸ’¬</h2>\r\n\r\n        {activeChats.map((chat) => (\r\n          <div\r\n            key={chat.chatId}\r\n            onClick={() => selectChat(chat)}\r\n            style={{\r\n              padding: '10px',\r\n              cursor: 'pointer',\r\n              backgroundColor: selectedChat?.chatId === chat.chatId ? '#eee' : 'transparent',\r\n              fontWeight: chat.adminHasUnread ? 'bold' : 'normal'\r\n            }}\r\n          >\r\n            {chat.userName}\r\n            {chat.adminHasUnread && <span style={{ color: 'red' }}> (New!)</span>}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* RIGHT CHAT WINDOW */}\r\n      <div style={{ flexGrow: 1, padding: '10px' }}>\r\n        {selectedChat ? (\r\n          <>\r\n            <h3>Chat with {selectedChat.userName}</h3>\r\n\r\n            <div style={{ height: '300px', overflowY: 'scroll', border: '1px solid #ccc', padding: '10px' }}>\r\n              {messages.map((msg, i) => (\r\n                <p key={i} style={{ textAlign: msg.sender === 'admin' ? 'right' : 'left' }}>\r\n                  <strong>{msg.sender === 'admin' ? 'You' : selectedChat.userName}:</strong> {msg.text}\r\n                </p>\r\n              ))}\r\n            </div>\r\n\r\n            <form onSubmit={sendMessage} style={{ marginTop: '10px' }}>\r\n              <input\r\n                type=\"text\"\r\n                value={message}\r\n                onChange={(e) => setMessage(e.target.value)}\r\n                placeholder=\"Type your reply...\"\r\n              />\r\n              <button type=\"submit\">Reply</button>\r\n            </form>\r\n          </>\r\n        ) : (\r\n          <p>Select a user to start chatting.</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AdminPanel;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}